# PRD: 로아원 (LoaOne)

> 로스트아크 유저를 위한 올인원 정보 플랫폼

**Version**: 1.0
**Last Updated**: 2025-02
**Status**: Live (https://loaone.vercel.app)

---

## 1. 제품 개요

### 1.1 배경

로스트아크는 다양한 콘텐츠(장비, 보석, 카드, 각인, Ark Passive 등)와 복잡한 데이터 구조를 가진 MMORPG이다. 기존 정보 사이트들은 단편적인 정보만 제공하거나, 개인화 기능이 부족하며, 모바일 대응이 미흡하다.

### 1.2 목표

로스트아크의 **캐릭터 정보 조회**, **성장 추적**, **커뮤니티 기능**을 하나의 플랫폼에서 제공하여, 유저가 게임 플레이에 필요한 모든 정보를 빠르고 직관적으로 확인할 수 있도록 한다.

### 1.3 핵심 가치

| 가치 | 설명 |
|------|------|
| **속도** | SSR + React Query 하이드레이션으로 즉시 콘텐츠 표시 |
| **직관성** | 복잡한 게임 데이터를 시각적으로 정리된 UI로 제공 |
| **개인화** | Discord 로그인 기반 즐겨찾기, 프로필, 활동 관리 |
| **커뮤니티** | 아바타 쇼케이스를 통한 유저 간 공유와 소통 |

---

## 2. 타겟 유저

### 2.1 페르소나

**일반 유저 (비로그인)**
- 캐릭터 검색으로 장비/스킬/보석 등 확인
- 랭킹 조회로 서버별 상위 유저 파악
- 레이드 공략 참고
- 실시간 게임 일정(카오스게이트, 모험섬) 확인

**활성 유저 (로그인)**
- 즐겨찾기로 관심 캐릭터 빠른 접근
- 성장 히스토리 추적 (7일/30일/90일)
- 아바타 쇼케이스 등록 및 좋아요
- 프로필 관리 및 원정대 캐릭터 조회

---

## 3. 기능 명세

### 3.1 홈 (`/`)

#### 3.1.1 이벤트 슬라이더
- 로스트아크 공식 API에서 현재 진행 중인 이벤트를 가져와 캐러셀로 표시
- 이벤트 배너 이미지, 제목, 외부 링크 제공

#### 3.1.2 실시간 일정 카드
- 주간 캘린더(오늘 강조)
- 실시간 카운트다운 타이머: 카오스게이트, 모험섬, 필드보스
- 다음 모험섬 3개 표시 (보상 아이템 미리보기, 등급별 색상 테두리)
- 모험섬 클릭 시 전체 보상 목록 모달

#### 3.1.3 공지사항 / 패치노트
- 공식 공지사항 최근 4건 (업데이트 제외)
- 패치노트 최근 4건 (업데이트만 필터)
- 한국어 날짜 포맷, 외부 링크

#### 3.1.4 즐겨찾기 사이드바 (로그인 시)
- Supabase `favorites` 테이블에서 사용자의 즐겨찾기 캐릭터 목록
- 캐릭터명, 직업, 아이템 레벨, 서버 표시
- 클릭 시 해당 캐릭터 페이지로 이동

#### 3.1.5 인기 검색어 사이드바
- 최근 7일간 검색 로그 집계 상위 5개 캐릭터
- 1~3위 메달 아이콘, 캐릭터명/직업/아이템 레벨/서버

---

### 3.2 캐릭터 상세 (`/characters/[name]`)

#### 3.2.1 서버 사이드 처리
- 검색 로그 기록 (`search_logs`)
- 랭킹 데이터 갱신 (`character_rankings` upsert)
- 즐겨찾기 데이터 갱신 (존재 시)

#### 3.2.2 캐릭터 헤더
- 캐릭터명, 서버, 직업 아이콘, 아이템 레벨, 길드명, 칭호
- 대표 각인 (Ark Passive에서 파싱)
- 캐릭터 전신 이미지

#### 3.2.3 탭 구성 (6개)

**장비 탭 (기본)**
- 방어구 6종: 강화 수치, 품질, 연마 단계, 등급별 색상
- 악세서리 3종: 품질, 전투 특성(치특신 등), 티어 색상
- 어빌리티 스톤: 각인 3개(긍정2 + 부정1), 레벨 합산
- 팔찌: 특수 옵션 파싱
- 보석 카드: 장착 보석 그리드(아이콘, 이름, 레벨, 효과)
- 카드 세트: 세트명, 세트 효과 레벨, 각성 레벨
- Ark 격자: 코어 파편, 효과, 등급 색상, 호버 툴팁
- Ark Passive: 진화/깨달음/도약 3열, 포인트, 레벨, 효과
- 전투 특성: 6종 프로그레스 바(/1800 기준), 상위 2개 하이라이트
- 각인: 활성 각인 목록, 출처 표시(스톤/악세)
- 수집품: 10종, 현재/최대 포인트

**아바타 탭**
- 7개 슬롯: 무기, 머리, 상의, 하의, 얼굴1, 얼굴2, 이동효과
- 각 슬롯: 외부(스킨 S) + 내부(스탯 T) 아바타
- 등급별 테두리 색상, 호버 툴팁
- 염색 정보 섹션

**스킬 탭**
- 스킬 포인트 사용량/총량
- 장착 스킬 그리드: 아이콘, 이름, 레벨, 룬, 트라이포드

**히스토리 탭**
- 아이템 레벨 추이 차트 (Recharts 라인 그래프)
- 기간 필터: 7일, 30일, 90일, 전체
- 데이터: Supabase `level_history` 테이블

**수집품 탭**
- 장비 탭의 수집품 확장 뷰

**캐릭터 탭**
- 계정 내 전체 캐릭터 목록
- 각 캐릭터: 이미지, 이름(링크), 직업, 서버, 아이템 레벨

---

### 3.3 랭킹 (`/rankings`)

#### 3.3.1 데이터 소스
- `character_rankings` 테이블 (캐릭터 검색 시 자동 적재)

#### 3.3.2 포디움 디스플레이
- 1~3위 대형 카드 (2위, 1위, 3위 순서 배치)
- 랭크 배지, 캐릭터명, 직업, 서버, 전투력
- 서포터: 초록색, 딜러: 빨간색

#### 3.3.3 랭킹 테이블
- 컬럼: 순위, 캐릭터, 아이템 레벨, 전투력, 클래스, 서버, 각인
- 필터: 서버별, 직업별 (아키타입 그룹)
- 더보기 버튼(20개씩), 잔여 수량 표시
- 모바일: 컴팩트 3열 레이아웃

---

### 3.4 레이드 공략 (`/cunning-paper`)

#### 3.4.1 목록 페이지
- 카테고리 탭: ALL, 카제로스, 군단장, 어비스, 가디언, 그림자 레이드
- 검색 바: 레이드명 필터
- 카드 그리드: 레이드명, 카테고리 배지(색상), 난이도, 게이트 수

#### 3.4.2 상세 페이지
- 헤더: 뒤로 가기, 레이드명, 난이도 배지, 게이트 네비게이션
- 사이드바: 딜러/서포터 아이템 정보
- 본문: 타임라인 형식 기믹 섹션 (HP 구간 + 기믹명 + 설명)

---

### 3.5 아바타 쇼케이스 (`/showcase`)

#### 3.5.1 갤러리
- 정렬: 최신순, 인기순
- 페이지네이션: 12개씩, 무한 스크롤
- 카드: 캐릭터 이미지, 이름, 직업/서버/레벨 배지, 설명 미리보기, 좋아요 수, Discord 유저 정보

#### 3.5.2 등록 (`/showcase/register`)
- 인증 필요 (Discord OAuth)
- 캐릭터명 입력 → Lost Ark API 조회
- 설명 텍스트 (선택)
- 아바타 미리보기
- 등록 시: 캐릭터 이미지 다운로드 → Supabase Storage 업로드 → DB 기록

#### 3.5.3 상세 (`/showcase/[id]`)
- 캐릭터 전신 이미지
- 정보 카드: 이름, 서버, 직업, 레벨, 좋아요 버튼
- 설명 카드: 인용 형식, 작성자 Discord 정보
- 장착 아바타 카드 + 염색 정보
- 본인 게시글: 삭제 가능
- 좋아요: 본인 게시글 불가, 토글 방식, 낙관적 UI 업데이트

---

### 3.6 프로필 (`/profile`)

- 인증 필요
- Discord 프로필 정보 표시
- 대표 캐릭터 정보: 전신 이미지, 서버, 직업, 아이템 레벨, 전투력, 길드
- 활동 내역: 쇼케이스 게시글 목록, 삭제 기능, 새 등록 링크
- 원정대 캐릭터 목록

---

### 3.7 대표 캐릭터 설정 (`/setup-character`)

- 미들웨어: `main_character` 메타데이터 없는 로그인 유저 자동 리다이렉트
- 캐릭터명 입력 → Supabase Auth `user_metadata.main_character` 업데이트
- 완료 후 홈으로 리다이렉트

---

### 3.8 글로벌 네비게이션

**데스크톱**
- 로고, PAPER / RANKING / AVATAR / PROFILE 링크
- 캐릭터 검색 입력
- 로그인/로그아웃 버튼 (Discord 아바타)

**모바일**
- 햄버거 메뉴 → 풀스크린 오버레이
- 캐릭터 검색 상단 배치
- 세로 네비게이션 링크, 활성 페이지 표시

---

## 4. 인증 및 보안

### 4.1 인증 흐름
1. Discord OAuth (Supabase Auth 통합)
2. 쿠키 기반 세션 관리 (`@supabase/ssr`)
3. 미들웨어: 모든 라우트에서 세션 확인
4. `main_character` 미설정 시 `/setup-character` 리다이렉트

### 4.2 데이터 보안
- Supabase Row Level Security (RLS)
- `favorites`: `auth.uid() = user_id` 정책
- `avatar_likes`: 본인 좋아요 방지 로직
- `avatar_showcase`: 소유자만 삭제 가능
- API 키 서버 사이드 전용 (클라이언트 노출 없음)

---

## 5. 데이터베이스 스키마

| 테이블 | 목적 | 주요 컬럼 |
|--------|------|-----------|
| `search_logs` | 검색 로그 | character_name, server_name, class, item_level, searched_at |
| `character_rankings` | 랭킹 | character_name, server_name, class, item_level, combat_level, guild, engraving |
| `favorites` | 즐겨찾기 | user_id, character_name, server_name, item_level, class |
| `level_history` | 성장 기록 | character_name, item_level, combat_level, recorded_at |
| `raids` | 레이드 목록 | name, type, difficulty, gate_count, order_index |
| `raid_gates` | 레이드 게이트 | raid_id, gate_number, subtitle |
| `raid_sections` | 기믹 섹션 | gate_id, order_index, title, subtitle |
| `avatar_showcase` | 아바타 쇼케이스 | user_id, character_name, character_image, description, avatar_items(JSON) |
| `avatar_likes` | 좋아요 | showcase_id, user_id |

---

## 6. 외부 의존성

| 서비스 | 용도 | 비고 |
|--------|------|------|
| Lost Ark Open API | 캐릭터/이벤트/공지 데이터 | Bearer 토큰 인증, 서버 사이드 프록시 |
| Supabase | DB + Auth + Storage | PostgreSQL, Discord OAuth, 이미지 저장 |
| Vercel | 배포 | Next.js 자동 배포, Edge Runtime |
| Lost Ark CDN | 게임 아이콘/이미지 | `cdn-lostark.game.onstove.com` |

---

## 7. 기술 아키텍처

### 7.1 렌더링 전략
- **SSR**: 홈, 캐릭터 상세, 랭킹 (SEO + 초기 로딩 최적화)
- **CSR**: React Query `initialData` 하이드레이션으로 백그라운드 리페치
- **ISR**: 이벤트/공지 데이터 5분 갱신

### 7.2 상태 관리
- **서버 상태**: React Query 5 (캐싱, 백그라운드 동기화, stale-while-revalidate)
- **클라이언트 상태**: Zustand 5 (즐겨찾기, 유저 정보, 알림, 좋아요)

### 7.3 스택
- Next.js 16 (App Router, React Compiler)
- React 19, TypeScript 5 (strict)
- Tailwind CSS 4 + Shadcn/ui (Radix UI)
- Framer Motion (애니메이션)
- Recharts (차트)

---

## 8. 반응형 디자인

| 구간 | 레이아웃 |
|------|----------|
| 모바일 (<768px) | 단일 열, 햄버거 메뉴, 수평 스크롤 탭 |
| 태블릿 (768-1024px) | 2열, 네비게이션 링크 표시 |
| 데스크톱 (>1024px) | 3열, 전체 네비게이션 + 검색 |
| 커스텀: `nav` (1130px) | 네비게이션 브레이크포인트 |
| 커스텀: `desktop` (1400px) | 최대 콘텐츠 너비 |

---

